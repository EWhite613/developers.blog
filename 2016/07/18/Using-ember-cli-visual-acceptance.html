<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Using ember-cli-visual-acceptance</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://ewhite613.github.io/hubpress.io/favicon.ico">

    <link rel="stylesheet" type="text/css" href="//ewhite613.github.io/hubpress.io/themes/casper/assets/css/screen.css?v=1468851957883" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />

    <link rel="canonical" href="https://ewhite613.github.io/hubpress.io/2016/07/18/Using-ember-cli-visual-acceptance.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Using ember-cli-visual-acceptance" />
    <meta property="og:description" content="Installation Simple as running &#x60;ember install ember-cli-visual-acceptance&#x60; Testem.json In order for ember-cli-visual-acceptance to capture images, &quot;launch_in_ci&quot; must contain ethier SlimerJsVisualAcceptance or PhantomJsVisualAcceptance. Example: Testem.json {   &quot;framework&quot;: &quot;mocha&quot;,   &quot;test_page&quot;: &quot;tests/index.html?hidepassed&quot;,   &quot;disable_watching" />
    <meta property="og:url" content="https://ewhite613.github.io/hubpress.io/2016/07/18/Using-ember-cli-visual-acceptance.html" />
    <meta property="article:tag" content="ember-cli-visual-acceptance" />
    <meta property="article:tag" content=" Blog" />
    <meta property="article:tag" content=" Open Source" />
    <meta property="article:tag" content=" Visual Regression" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Using ember-cli-visual-acceptance" />
    <meta name="twitter:description" content="Installation Simple as running &#x60;ember install ember-cli-visual-acceptance&#x60; Testem.json In order for ember-cli-visual-acceptance to capture images, &quot;launch_in_ci&quot; must contain ethier SlimerJsVisualAcceptance or PhantomJsVisualAcceptance. Example: Testem.json {   &quot;framework&quot;: &quot;mocha&quot;,   &quot;test_page&quot;: &quot;tests/index.html?hidepassed&quot;,   &quot;disable_watching" />
    <meta name="twitter:url" content="https://ewhite613.github.io/hubpress.io/2016/07/18/Using-ember-cli-visual-acceptance.html" />
    
    <script type="application/ld+json">
null
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="" href="https://ewhite613.github.io/hubpress.io/rss/" />
</head>
<body class="post-template tag-ember-cli-visual-acceptance tag-Blog tag-Open-Source tag-Visual-Regression nav-closed">

    

    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        
    </nav>
</header>

<main class="content" role="main">
    <article class="post tag-ember-cli-visual-acceptance tag-Blog tag-Open-Source tag-Visual-Regression">

        <header class="post-header">
            <h1 class="post-title">Using ember-cli-visual-acceptance</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2016-07-18">18 July 2016</time>  on <a href="https://ewhite613.github.io/hubpress.io/tag/ember-cli-visual-acceptance/">ember-cli-visual-acceptance</a>, <a href="https://ewhite613.github.io/hubpress.io/tag/Blog/"> Blog</a>, <a href="https://ewhite613.github.io/hubpress.io/tag/Open-Source/"> Open Source</a>, <a href="https://ewhite613.github.io/hubpress.io/tag/Visual-Regression/"> Visual Regression</a>
            </section>
        </header>

        <section class="post-content">
            <div class="sect1">
<h2 id="_installation">Installation</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>Simple as running `ember install ember-cli-visual-acceptance`</pre>
</div>
</div>
<div class="sect2">
<h3 id="_testem_json">Testem.json</h3>
<div class="paragraph">
<p>In order for <code>ember-cli-visual-acceptance</code> to capture images, <code>"launch_in_ci"</code> must contain ethier <code>SlimerJsVisualAcceptance</code> or <code>PhantomJsVisualAcceptance</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Testem.json</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{
  "framework": "mocha",
  "test_page": "tests/index.html?hidepassed",
  "disable_watching": true,
  "launch_in_ci": [
    "SlimerJsVisualAcceptance"
  ],
  "launch_in_dev": [
    "Firefox"
  ],
  "launchers": {
    "PhantomJsVisualAcceptance": {
      "command": "phantomjs vendor/phantomjs-launcher.js &lt;url&gt;",
      "protocol": "browser"
    },
    "SlimerJsVisualAcceptance": {
      "command": "slimerjs -jsconsole vendor/phantomjs-launcher.js &lt;url&gt;",
      "protocol": "browser"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage">Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inside an integration or acceptance test you can use <code>return capture('&lt;image-label&gt;')</code> at the end of an <code>it()</code> function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">it('renders', function () {
  // Set any properties with this.set('myProperty', 'value')
  // Handle any actions with this.on('myAction', function (val) { ... })</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  this.render(hbs`{{frost-file-picker}}`)
  expect(this.$('.frost-file-picker')).to.have.length(1)
  return capture('Basic-File-Picker')
})</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>You can also use this functionality for async testing:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">it('renders', function (done) {
  // Set any properties with this.set('myProperty', 'value')
  // Handle any actions with this.on('myAction', function (val) { ... })</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  this.render(hbs`{{frost-file-picker}}`)
  expect(this.$('.frost-file-picker')).to.have.length(1)
  capture('Basic-File-Picker').then(function (data) {
    console.log(arguments)
    done()
  }).catch(function (err) {
    done(err)
  })
})</pre>
</div>
</div>
<div class="paragraph">
<p>In this case done comes from <code>it('test', function (done) { &#8230;&#8203; }</code>. You can also use the <code>then</code> functionality to get creative rather than using done.
<code>arguments</code> will display the response from ResembleJS or the message, <code>'No passed image. Saving current test as base'</code> (If there is no current baseline image).</p>
</div>
<div class="sect2">
<h3 id="_usage_with_qunit">Usage with Qunit</h3>
<div class="paragraph">
<p>To use with Qunit you must supply the <code>assert</code> parameter.</p>
</div>
<div class="paragraph">
<p>Example (Using [ember-cli-showdown](<a href="https://github.com/gcollazo/ember-cli-showdown/blob/master/tests/integration/components/markdown-to-html-test.js)" class="bare">https://github.com/gcollazo/ember-cli-showdown/blob/master/tests/integration/components/markdown-to-html-test.js)</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import hbs from 'htmlbars-inline-precompile';
import { moduleForComponent, test } from 'ember-qunit';</code></pre>
</div>
</div>
<div class="paragraph">
<p>moduleForComponent('markdown-to-html', 'Integration | Component | markdown to html', {
  integration: true
});</p>
</div>
<div class="paragraph">
<p>test('positional parameter', function(assert) {
  assert.expect(1);</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  this.set('markdown', '*hello world*');
  this.render(hbs`{{markdown-to-html markdown}}`);
  assert.equal(this.$('&gt; *').html(), '&lt;p&gt;&lt;em&gt;hello world&lt;/em&gt;&lt;/p&gt;');
  return capture('Markdown', null, null, 0.00, null, assert);
});</pre>
</div>
</div>
<div class="sect3">
<h4 id="_larger_frame">Larger frame</h4>
<div class="paragraph">
<p>In order to go beyond the default 640x340px dimensions you can supply the width and height to the capture function. The following shows an example to get a 1920x4041 container: <code>capture('&lt;image-label&gt;', 1920, 4041)</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_targeting_an_element">Targeting an element</h4>
<div class="paragraph">
<p>ember-cli-visual-acceptance also has the ability to target a specific element. Given a DOM element ember-cli-visual-acceptance will capture the specified element rather than the default <code>#ember-testing-container</code>. To target an element you must pass in the DOM element.</p>
</div>
<div class="sect4">
<h5 id="_target_with_an_id">Target with an id</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">capture('Markdown', null, null, 0.00, document.getElementById('foo'));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_target_with_class_selectors">Target with class selectors</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">capture('drop-down-container', null, null, 0.00, this.$('.drop-down-container')[0])</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_travis">Setting up travis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replace <code>ember test</code> with <code>ember tva</code>. This command comes with <code>ember-cli-visual-acceptance</code> and provides the functionality for commenting  a report (Stored on Imgur) on a PR from the Travis build.</p>
</div>
<div class="paragraph">
<p>Add your github credentials to <code>before_script:</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">before_script:
- git config --global user.email "ericwhite613@gmail.com"
- git config --global user.name "Eric White"
- git config --global push.default simple
- npm set progress=false
- git config credential.helper "store --file=.git/credentials"
- echo "https://${GH_TOKEN}:@github.com" &gt; .git/credentials</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Secure Variables (Display value in build log = <code>OFF</code>)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add <code>GH_TOKEN</code> to Travis. Personal Access Token must have push access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Unsecure Variables (Display value in build log = <code>ON</code>)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add <code>RO_GH_TOKEN</code> Unsecure token that can only read.</p>
</li>
<li>
<p>Add <code>VISUAL_ACCEPTANCE_TOKEN</code> token, value can be found [here](<a href="https://travis-ci.org/ciena-frost/ember-frost-file-picker/jobs/137522760#L275" class="bare">https://travis-ci.org/ciena-frost/ember-frost-file-picker/jobs/137522760#L275</a>)</p>
</li>
<li>
<p>If you put the <code>VISUAL_ACCEPTANCE_TOKEN</code> directly in your code and commit it to Github; Github will revoke the token.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_browsers_html2canvas_vs_phantomjs_render_callback">Browsers - html2canvas vs. PhantomJS render callback</h3>
<div class="paragraph">
<p>You must enable the display to use headless browsers by adding the following to the <code>before_script</code> hook:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">before_script:
- "export DISPLAY=:99.0"
- "sh -e /etc/init.d/xvfb start"
- sleep 3 # give xvfb some time to start</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_phantomjs_slimerjs">PhantomJS - SlimerJS</h4>
<div class="paragraph">
<p>[PhantomJS](<a href="http://phantomjs.org/" class="bare">http://phantomjs.org/</a>) and [SlimerJS](<a href="https://slimerjs.org/" class="bare">https://slimerjs.org/</a>) can both be used with this tool to capture images.</p>
</div>
<div class="paragraph">
<p>Personally I prefer using SlimerJS as their version of Gecko matches the latest Firefox. While PhantomJS Webkit is about a year behind Safari&#8217;s Webkit version. <code>SlimerJsVisualAcceptance</code> images come out much more accurate. Additionally, debugging the images produced from the <code>.ember-testing-container</code> in Firefox is useful. Since the <code>.ember-testing-container</code> is identical in SlimerJS and Firefox ( at least I&#8217;ve never seen a difference between the two).</p>
</div>
<div class="sect4">
<h5 id="_warning">Warning</h5>
<div class="paragraph">
<p>With certain repositories I&#8217;ve had trouble with SlimerJS having segmentation faults on both Linux and Mac. I&#8217;ve yet to resolve this issue.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_html2canvas">Html2Canvas</h4>
<div class="paragraph">
<p>Html2Canvas is used when a browser does not have the function <code>window.callPhantom</code> (Only PhantomJS and SlimerJS have this defined). Html2Canvas is still in beta and as result you will see some issues.
Html2Canvas relies on Canvas drawing support. I find Chrome has the best Canvas drawing support (miles ahead of their competitors), while Firefox has the second best Canvas drawing support.</p>
</div>
<div class="sect4">
<h5 id="_svgs">SVGs</h5>
<div class="paragraph">
<p>Html2Canvas has difficulties rendering SVGs (more so in Firefox than in Chrome). As a result I have added a new <strong>expermental</strong> functionality that attempts to render the svgs better.
You can use this experimental feature by setting <code>experimentalSvgs</code> to <code>true</code> (Example: <code>capture('svg-experimental', null, null, 0.00, null, true)</code>).</p>
</div>
<div class="paragraph">
<p>Experimental SVGs will not be used for PhantomJS and SlimerJS as their rendering handles SVGs (since it&#8217;s basically just a simple screenshot of the page)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_firefox">Using Firefox</h4>
<div class="paragraph">
<p>To use Firefox in Travis simply set</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">  // Testem.json
  "launch_in_ci": [
    "Firefox"
  ],</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add the following to your <code>.travis.yml</code> to get the latest version of Firefox:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">addons:
  firefox: "latest"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_slimerjs">Using SlimerJS</h4>
<div class="listingblock">
<div class="title">Testem.json</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{
  "framework": "mocha",
  "test_page": "tests/index.html?hidepassed",
  "disable_watching": true,
  "launch_in_ci": [
    "SlimerJsVisualAcceptance"
  ],
  "launch_in_dev": [
    "Firefox"
  ],
  "launchers": {
    "PhantomJsVisualAcceptance": {
      "command": "phantomjs vendor/phantomjs-launcher.js &lt;url&gt;",
      "protocol": "browser"
    },
    "SlimerJsVisualAcceptance": {
      "command": "slimerjs -jsconsole vendor/phantomjs-launcher.js &lt;url&gt;",
      "protocol": "browser"
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_phantomjs">Using PhantomJS</h4>
<div class="listingblock">
<div class="title">Testem.json</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">{
  "framework": "mocha",
  "test_page": "tests/index.html?hidepassed",
  "disable_watching": true,
  "launch_in_ci": [
    "PhantomJsVisualAcceptance"
  ],
  "launch_in_dev": [
    "Safari"
  ],
  "launchers": {
    "PhantomJsVisualAcceptance": {
      "command": "phantomjs vendor/phantomjs-launcher.js &lt;url&gt;",
      "protocol": "browser"
    },
    "SlimerJsVisualAcceptance": {
      "command": "slimerjs -jsconsole vendor/phantomjs-launcher.js &lt;url&gt;",
      "protocol": "browser"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reports_for_multiple_browsers">Reports for  multiple browsers</h3>
<div class="paragraph">
<p>Producing a report for multiple browsers is perfectly fine. All you need to do is add your collection of browsers to <code>launch_in_ci</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Testem.json</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">"launch_in_ci": [
    "Firefox",
    "SlimerJsVisualAcceptance"
  ],</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__code_timeout_of_2000ms_exceeded_code"><code>timeout of 2000ms exceeded</code></h3>
<div class="paragraph">
<p>With Travis you may find you see this error a few times. Sometimes Travis can take a while to run capture (especially if you&#8217;re using experimentalSvgs and have a lot of svgs on the page), and exceeds the timeout.</p>
</div>
<div class="paragraph">
<p>To resolve this simply increase the timeout by doing <code>this.timeout(5000)</code> in Mocha. I believe in Qunit you do <code>QUnit.config.testTimeout = 5000</code>.</p>
</div>
<div class="paragraph">
<p>In Mocha you can also set the timeout globally in <code>test-helper.js</code>:</p>
</div>
<div class="listingblock">
<div class="title">test-helper.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">import resolver from './helpers/resolver'
import { setResolver } from 'ember-mocha'
import { mocha } from 'mocha'</code></pre>
</div>
</div>
<div class="paragraph">
<p>mocha.setup({
  // customize as needed
  timeout: 5000
})
setResolver(resolver)</p>
</div>
<div class="paragraph">
<p>In <code>describeComponent</code> there is no <code>this.timeout</code>. So you can set the timeout in the beforeEach fucntion by doing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">describeComponent(
  'frost-select',
  'Integration: FrostSelectComponent',
  {
    integration: true
  },
  function () {
    let props
    let dropDown
    beforeEach(function () {
      this.test._timeout = 6000
    })
    ...
})</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_notes">Notes</h4>
<div class="ulist">
<ul>
<li>
<p>Travis will upload the reports to Imgur</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you would like to help or have ideas on improving this tool I&#8217;m available on the Ember community slack @ewhite613 - issues and PRs also welcome :)</p>
</div>
</div>
</div>
</div>
</div>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="https://ewhite613.github.io/hubpress.io/author/EWhite613/" style="background-image: url(https://avatars.githubusercontent.com/u/9057680?v&#x3D;3)"><span class="hidden">Eric White's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="https://ewhite613.github.io/hubpress.io/author/EWhite613/">Eric White</a></h4>

                    <p>Read <a href="https://ewhite613.github.io/hubpress.io/author/EWhite613/">more posts</a> by this author.</p>
                <div class="author-meta">
                    <span class="author-location icon-location">Ottawa,Ontario,Canada</span>
                    
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Using%20ember-cli-visual-acceptance&amp;url=https://ewhite613.github.io/hubpress.io/2016/07/18/Using-ember-cli-visual-acceptance.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://ewhite613.github.io/hubpress.io/2016/07/18/Using-ember-cli-visual-acceptance.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://ewhite613.github.io/hubpress.io/2016/07/18/Using-ember-cli-visual-acceptance.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>


    </article>

</main>

<aside class="read-next">
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="https://ewhite613.github.io/hubpress.io"></a> &copy; 2016</section>
            <section class="poweredby">Proudly published with <a href="http://hubpress.io">HubPress</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>

    <script type="text/javascript" src="//ewhite613.github.io/hubpress.io/themes/casper/assets/js/jquery.fitvids.js?v=1468851957883"></script>
    <script type="text/javascript" src="//ewhite613.github.io/hubpress.io/themes/casper/assets/js/index.js?v=1468851957883"></script>

</body>
</html>
